worker_processes 1;

events {
    worker_connections 1024;
}

# Blok 'stream' harus berada di level root di dalam nginx.conf,
# bukan di dalam blok http atau di luar struktur yang benar.
stream {
    # Definisi upstream untuk service MongoDB di Docker network
    upstream mongodb_upstream {
        server mongodb:27017; # 'mongodb' adalah nama service di docker-compose.yml
                               # '27017' adalah port default MongoDB
    }

    # Server untuk mendengarkan koneksi masuk di port 80
    server {
        listen 80; # Mendengarkan di port 80
        proxy_pass mongodb_upstream; # Meneruskan koneksi ke upstream MongoDB
        # Optional: timeout settings for proxy
        proxy_timeout 1h; # Sesuaikan jika koneksi Anda membutuhkan waktu lama (misalnya backup)
        proxy_upload_timeout 1h;
        proxy_download_timeout 1h;
    }
}